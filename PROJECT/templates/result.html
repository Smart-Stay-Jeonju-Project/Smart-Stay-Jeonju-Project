{% extends "layout.html" %}

{% block title %}상세 페이지{% endblock %}

{% block contents %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css')}}">

<div class="accommodation-detail-container" style="max-width: 1200px; margin: auto; padding: 2rem 1rem;">

    <!-- 숙소 이미지 + 정보 -->
    <div class="top-section">
        <!-- 숙소 이미지 -->
        <div class="image-section">
            <!--숙소 경로 오류 : 절대경로로 수정 -->
            <!-- oneerror : 이미지 파일 없는 경우 대체 할 이미지 설정-->
            <img src="{{ url_for('static', filename='images/tmp/' + result_accommodation.image) }}" 
            onerror="this.src='{{ url_for('static', filename='images/tmp/logo.jpg') }}'"
            alt="{{ result_accommodation.name }}">
        </div>

        <!-- 숙소 정보 -->  
        <div class="info-section">
            <h2>{{ result_accommodation.name }}</h2>
            {% if result_accommodation.feature != None %}
                <p>[{{ result_accommodation.feature}}]</p>
            {% endif %}
            <p><strong>주소:</strong> {{ result_accommodation.address }}</p>
            <p><strong>감성점수:</strong> 🙂: 00 , 🙁: 00 </p>
            <div id="keywordList" style="margin-top: 10px;">
                <p><strong>키워드:</strong></p>
                <ul id="keywordUI"></ul>
                    {% for keyword in result_keyword %}
                        <li>
                            <a href="{{ url_for('main.search') }}?search_type=keyword&search_term={{ keyword['keyword_text'] }}">
                                {{ keyword['keyword_text'] }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
            <!-- {{ result_accommodation.rating | round(1) }}  : Jinja2 템플릿 문법에서 사용하는 필터(filter) -->
            <p><strong>평점:</strong> ⭐ {{ result_accommodation.rating | round(1) }}점 <!--({{ result_accommodation.rating_count }}개 리뷰)--></p>
        </div>
        <!-- 
            <p>LAT: {{ result_accommodation.lat }}</p>
            <p>LNG: {{ result_accommodation.lng }}</p> 
        -->
        <!-- 지도 영역 -->
        <div id="map_in_result"></div>
        <script>
            const searchTerm = "{{ search_term }}"; 
        </script>
        <script>
            result_accommodation = {{ result_accommodation | tojson | safe }};
        </script>
        <script src="{{ url_for('static', filename='js/result_maps.js') }}"></script>
        <script
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDg8UOceSAXDR2NnMikougMamOyAxbdRac&callback=initMap"
            async defer>
        </script>
    </div>
    <div class="review-section">
        <div>
            <h3>AI 요약 리포트</h3>
            {% if result_accommodation.report_text %}
                <!--<p>{{ result_accommodation.report_text }}</p>-->
                <!--result_service에서 가져온 리포트 내용 분류 \n 를 <br>로 바꿔줌-->
                <p><br>{{ result_accommodation.report_text | replace('\n', '<br><br>').replace('n','야놀자').replace('y','여기어때')| safe }} </p>
            {% else %}
                <p>AI 요약 리포트가 생성되지 않았습니다</p>
            {% endif %}

        </div>
    </div>
    <div class="review-section">
        <div>
            <h3>감성분석 키워드 워드클라우드</h3>
            {% if result_accommodation.p_img or result_accommodation.n_img%}
                <p><strong>긍정</strong></p>
                <img  width="400px" src="{{ url_for('static', filename='images/report/' + result_accommodation.p_img) }}" alt="{{ result_accommodation.p_img }}">
                <p><strong>부정</strong></p>
                <img  width="400px" src="{{ url_for('static', filename='images/report/' + result_accommodation.n_img) }}" alt="{{ result_accommodation.n_img }}">
            {% else %}
                <p>감성분석 키워드 워드클라우드가 생성되지 않았습니다</p>
            {% endif %}
        </div>
    </div>
    <!-- 리뷰 영역 -->
    <div class="review-section">
        <div>
            <h3>정제한 리뷰 영역(최신순 10개 리뷰)</h3>
            {% if result_review %}
                <table border = "1" width="1200px"  class="table table-striped table-hover">
                    <thead>
                        <tr class="table-dark">
                            <th style="width: 10%;">닉네임</th>
                            <th style="width: 8%;">별점</th>
                            <th style="width: 8%;">타입</th>
                            <th style="width: 46%;">내용</th>
                            <th style="width: 10%;">작성날짜</th>
                            <th style="width: 10%;">출처</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for result_review in result_review['list'] %}
                        <tr>
                            <td>{{result_review['nickname']}}</td>
                            <td>⭐{{result_review['review_rating']}}점</td>
                            <td>{{result_review['review_type']}}</td>
                            <td>{{result_review['clean_reviews']}}</td>
                            <td>{{result_review['write_date']}}</td>
                            {%if result_review['review_source'] == 'y' %}
                            <td>여기어때</td>
                            {% else %}
                            <td>야놀자</td>
                            {% endif%}
                        </tr>
                        {% endfor %}
                    </tbody>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
